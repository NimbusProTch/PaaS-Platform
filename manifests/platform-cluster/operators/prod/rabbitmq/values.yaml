# RabbitMQ Production Configuration
# Production-ready HA cluster with 3 replicas

# Cluster naming (will be overridden by generator)
clusterName: demo-rabbitmq
namespace: demo-prod

# Tenant and environment (will be injected by generator)
tenant: demo
environment: prod

# RabbitMQ version
rabbitmqVersion: "3.12"

# High Availability - 3 instances minimum
replicas: 3

# Storage configuration (production SSD)
storage:
  size: "20Gi"
  storageClass: "standard"

# Resource limits (production)
resources:
  requests:
    cpu: "1000m"
    memory: "2Gi"
  limits:
    cpu: "2000m"
    memory: "4Gi"

# RabbitMQ configuration
rabbitmq:
  # Additional plugins
  additionalPlugins:
    - rabbitmq_management
    - rabbitmq_prometheus
    - rabbitmq_shovel
    - rabbitmq_shovel_management
    - rabbitmq_federation
    - rabbitmq_federation_management

  # Additional configuration (production-tuned)
  additionalConfig: |
    cluster_formation.peer_discovery_backend = rabbit_peer_discovery_k8s
    cluster_formation.k8s.host = kubernetes.default
    cluster_partition_handling = pause_minority
    queue_master_locator = min-masters
    disk_free_limit.absolute = 2GB
    vm_memory_high_watermark.relative = 0.6
    collect_statistics_interval = 10000

# Service configuration
service:
  type: ClusterIP

# Monitoring (full production monitoring)
monitoring:
  enabled: true

# High availability
highAvailability:
  enabled: true

  # Pod anti-affinity (spread across nodes)
  affinity:
    topologyKey: kubernetes.io/hostname
    podAntiAffinityType: required

# Memory and disk alarms (production settings)
memoryHighWatermark:
  enabled: true
  type: relative
  value: 0.6

diskFreeLimit:
  enabled: true
  type: absolute
  value: "2GB"
