# Standard Profile Overrides for Percona MongoDB
# Balanced setup for staging/pre-production

replsets:
  - name: rs0
    size: 3
    affinity:
      antiAffinityTopologyKey: "kubernetes.io/hostname"
    podDisruptionBudget:
      minAvailable: 2
    resources:
      limits:
        cpu: "2"
        memory: 4Gi
      requests:
        cpu: "1"
        memory: 2Gi
    volumeSpec:
      persistentVolumeClaim:
        storageClassName: fast-ssd
        resources:
          requests:
            storage: 50Gi

# Daily and weekly backups
backup:
  enabled: true
  storages:
    minio-backup:
      type: s3
      s3:
        bucket: mongodb-backups
        endpointUrl: http://infraforge-minio.infraforge-storage:9000
        insecureSkipTLSVerify: true
  tasks:
    - name: daily-backup
      enabled: true
      schedule: "0 2 * * *"
      keep: 7
      storageName: minio-backup
      compressionType: gzip
      compressionLevel: 6
    - name: weekly-backup
      enabled: true
      schedule: "0 3 * * 0"
      keep: 4
      storageName: minio-backup
      compressionType: gzip
      compressionLevel: 9

# Basic monitoring
pmm:
  enabled: true
  serverHost: pmm-server.infraforge-monitoring
  resources:
    limits:
      cpu: 500m
      memory: 500Mi
    requests:
      cpu: 200m
      memory: 200Mi

# Prefer TLS
tls:
  mode: preferTLS
  certValidityDuration: 8760h

# Standard connection settings
configuration:
  net:
    maxIncomingConnections: 10000
  operationProfiling:
    mode: slowOp
    slowOpThresholdMs: 100
  storage:
    wiredTiger:
      engineConfig:
        cacheSizeGB: 2
  replication:
    oplogSizeMB: 5120