# Istio Helm Values
# Generated by InfraForge for {{ .Environment }} environment

# Istio Base configuration
base:
  enableCRDTemplates: true

# Istiod configuration
pilot:
  autoscaleEnabled: {{ .Values.pilot.autoscale.enabled }}
  autoscaleMin: {{ .Values.pilot.autoscale.min }}
  autoscaleMax: {{ .Values.pilot.autoscale.max }}
  
  resources:
    requests:
      cpu: {{ .Values.pilot.resources.requests.cpu }}
      memory: {{ .Values.pilot.resources.requests.memory }}
    limits:
      cpu: {{ .Values.pilot.resources.limits.cpu }}
      memory: {{ .Values.pilot.resources.limits.memory }}
  
  env:
    PILOT_ENABLE_WORKLOAD_ENTRY_AUTOREGISTRATION: true
    PILOT_ENABLE_CROSS_CLUSTER_WORKLOAD_ENTRY: true

# Global configuration
global:
  istioNamespace: istio-system
  defaultResources:
    requests:
      cpu: {{ .Values.global.defaultResources.requests.cpu }}
      memory: {{ .Values.global.defaultResources.requests.memory }}
    limits:
      cpu: {{ .Values.global.defaultResources.limits.cpu }}
      memory: {{ .Values.global.defaultResources.limits.memory }}
  
  proxy:
    resources:
      requests:
        cpu: {{ .Values.global.proxy.resources.requests.cpu }}
        memory: {{ .Values.global.proxy.resources.requests.memory }}
      limits:
        cpu: {{ .Values.global.proxy.resources.limits.cpu }}
        memory: {{ .Values.global.proxy.resources.limits.memory }}
  
  # Tracing configuration
  tracer:
    zipkin:
      address: "zipkin.istio-system:9411"

# Gateway configuration
gateways:
  istio-ingressgateway:
    autoscaleEnabled: {{ .Values.gateway.autoscale.enabled }}
    autoscaleMin: {{ .Values.gateway.autoscale.min }}
    autoscaleMax: {{ .Values.gateway.autoscale.max }}
    
    resources:
      requests:
        cpu: {{ .Values.gateway.resources.requests.cpu }}
        memory: {{ .Values.gateway.resources.requests.memory }}
      limits:
        cpu: {{ .Values.gateway.resources.limits.cpu }}
        memory: {{ .Values.gateway.resources.limits.memory }}
    
    service:
      type: LoadBalancer
      ports:
      - port: 80
        targetPort: 8080
        name: http2
      - port: 443
        targetPort: 8443
        name: https

  istio-egressgateway:
    enabled: {{ .Values.egress.enabled }}
    autoscaleEnabled: false
    autoscaleMin: 1
    autoscaleMax: 3

# Telemetry v2 configuration
telemetry:
  v2:
    enabled: true
    prometheus:
      configOverride:
        inboundSidecar:
          disable_host_header_fallback: true
        outboundSidecar:
          disable_host_header_fallback: true
        gateway:
          disable_host_header_fallback: true