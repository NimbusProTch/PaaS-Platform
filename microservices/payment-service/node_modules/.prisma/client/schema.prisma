generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Payment {
  id                    String  @id @default(uuid())
  orderId               String
  userId                String
  amount                Float
  currency              String  @default("usd")
  status                String  @default("pending") // pending, completed, failed, refunded, cancelled
  stripePaymentIntentId String  @unique
  stripeCustomerId      String?
  paymentMethod         String?

  metadata Json?

  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
  completedAt DateTime?
  failedAt    DateTime?
  cancelledAt DateTime?
  refundedAt  DateTime?

  refunds Refund[]

  @@index([orderId])
  @@index([userId])
  @@index([status])
  @@index([createdAt])
}

model Refund {
  id             String  @id @default(uuid())
  paymentId      String
  amount         Float
  currency       String
  status         String // pending, completed, failed
  reason         String?
  stripeRefundId String  @unique

  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
  completedAt DateTime?

  payment Payment @relation(fields: [paymentId], references: [id])

  @@index([paymentId])
  @@index([status])
}

model Webhook {
  id        String  @id @default(uuid())
  provider  String // stripe, paypal, etc.
  eventType String
  eventId   String  @unique
  payload   Json
  processed Boolean @default(false)

  createdAt   DateTime  @default(now())
  processedAt DateTime?

  @@index([provider, eventType])
  @@index([processed])
}
